<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="주문관리" width="1080" height="720" titletext="재고관리" oninit="주문관리_oninit" onload="주문관리_onload">
    <Layouts>
      <Layout height="720" mobileorientation="landscape" width="1080">
        <Static id="Static00" taborder="0" text="주문관리(발주)" left="40" top="30" width="120" height="60" onclick="Static00_onclick"/>
        <Div id="stock01_div" taborder="1" left="0.00%" top="0" height="410" text="" background="darkgreen" right="0.00%">
          <Layouts>
            <Layout>
              <Grid id="Grid00" taborder="0" left="1.76%" top="197" autofittype="col" binddataset="stock_grid1" height="203" right="1.67%" onheadclick="stock01_div_Grid00_onheadclick" oncellclick="stock01_div_Grid00_oncellclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="142"/>
                      <Column size="80"/>
                      <Column size="37"/>
                      <Column size="44"/>
                      <Column size="35"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="메뉴명"/>
                      <Cell col="1" text="메뉴코드"/>
                      <Cell col="2" text="현재재고"/>
                      <Cell col="3" text="bind:PRODUCT_CHECK" displaytype="checkboxcontrol" edittype="checkbox" checkboxfalsevalue="0" checkboxtruevalue="1"/>
                      <Cell col="4" text="발주재고" editinputtype="number"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:PRODUCT_NAME" textAlign="center"/>
                      <Cell col="1" text="bind:PRODUCT_CODE" textAlign="center"/>
                      <Cell col="2" displaytype="decoratetext" edittype="none" textAlign="center" text="expr:PRODUCT_QUANTITY &lt; 10 ? '&lt;fc v=\&quot;red\&quot;&gt;' + PRODUCT_QUANTITY + '&lt;/fc&gt;' : '&lt;fc v=\&quot;#666666\&quot;&gt;' + PRODUCT_QUANTITY + '&lt;/fc&gt;'"/>
                      <Cell col="3" displaytype="checkboxcontrol" edittype="checkbox" text="bind:PRODUCT_CHECK" checkboxfalsevalue="0" checkboxtruevalue="1"/>
                      <Cell col="4" displaytype="none" textAlign="center" text="bind:STOCK_ORDER_QUANTITY" editinputfilter="none,space,comma" editinputtype="number" edittype="expr:PRODUCT_CHECK=='0'?'none':'text'"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Div id="Div00" taborder="1" left="22" top="60" width="1037" height="120" text="" background="#dbdee2">
                <Layouts>
                  <Layout>
                    <Edit id="Edit00" taborder="0" left="16" top="43" width="85" height="20" onchanged="stock01_div_Div00_Edit00_onchanged" displaynulltext="메뉴명"/>
                    <Combo id="Combo03" taborder="1" text="카테고리" left="106" top="43" width="85" height="20" value="" index="-1" onitemchanged="stock01_div_Div00_Combo03_onitemchanged"/>
                    <Button id="Button00" taborder="2" text="발주신청" left="375" top="93" width="85" height="20" onclick="stock01_div_Div00_Button00_onclick"/>
                    <Button id="Button02" taborder="3" text="조회하기" left="375" top="70" width="85" height="20"/>
                  </Layout>
                </Layouts>
              </Div>
            </Layout>
          </Layouts>
        </Div>
        <Div id="stock02_div" taborder="2" left="0.00%" top="410" background="gray" bottom="0.00%" right="0">
          <Layouts>
            <Layout>
              <Grid id="Grid00" taborder="0" left="1.76%" binddataset="stock_grid2" autofittype="col" right="1.76%" bottom="5.29%" height="231">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="80"/>
                      <Column size="54"/>
                      <Column size="104"/>
                      <Column size="70"/>
                      <Column size="74"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="메뉴명"/>
                      <Cell col="1" text="발주수량"/>
                      <Cell col="2" text="발주일자"/>
                      <Cell col="3" text="신청자"/>
                      <Cell col="4" text="발주현황"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:PRODUCT_NAME"/>
                      <Cell col="1" text="bind:STOCK_ORDER_QUANTITY"/>
                      <Cell col="2" text="bind:STOCK_ORDER_DATE"/>
                      <Cell col="3" text="bind:ADMIN_CODE"/>
                      <Cell col="4"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="Button00" taborder="1" text="엑셀" height="30" bottom="Grid00:5" right="1.85%" width="70"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/*
1. 화면 초기화
2. 발주신청서 팝업창
3. 함수
4. 체크박스
*/

/* 테스트용 버튼 */
this.stock01_div_Div00_Button01_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{	
};


/*include "Base::lib_grid.xjs"*/

/* 1. 화면 초기화 */
this.주문관리_onload = function(obj:nexacro.Form,e:nexacro.EventInfo)
{	
	// grid1 list 불러오기
	this.fnStockMenuList();
	
	this.stock_order_month.insertRow(0);  
	this.stock_order_month.setColumn(0, "STOCK_ORDER_MONTH", ""); //코드도 같이 채워주어야 선택 시 빈칸이 되지 않는다
    this.stock_order_month.setColumn(0, "STOCK_ORDER_MONTH", "전체보기");

};

/* 2. 발주신청 버튼 */
this.stock01_div_Div00_Button00_onclick = function(obj:nexacro.Button, e:nexacro.ClickEventInfo) {

	/* (1) 체크된 row갯수 count */
	//조건식을 문자열로 작성하여 전달
    var condition = "PRODUCT_CHECK" + " == '1'";
	
    // getCaseCount 메서드 호출
    var chkCnt = this.stock_grid1.getCaseCount(condition);
	alert("체크된 메뉴 갯수 : " +chkCnt);
	
	/* (2) 체크된 행이 카운트 */
    if (chkCnt > 0) {
		this.stock_order.clearData();
		
		// 세션에서 ADMIN_CODE 가져오기
		var sessionLogin = nexacro.getApplication().Session_login;
		var adminCode = sessionLogin.getColumn(0, "ADMIN_CODE");

		for(var i=0; i<this.stock_grid1.rowcount; i++){
			if(this.stock_grid1.getColumn(i, "PRODUCT_CHECK") == "1"){
				var row = this.stock_order.addRow();
				//dataset에 ADMIN_CODE 추가
				this.stock_order.setColumn(row,0,adminCode);
				this.stock_order.copyRow(row, this.stock_grid1, i);
			}
		}
	}
};

/* 3. 함수 */
/* 3-1. grid1 list 불러오기*/
this.fnStockMenuList = function()
{
	var strSvcId    = "grid1MenuList";
	var strSvcUrl   = "svc::grid1MenuList.do";
	var inData      = "";
	var outData     = "stock_grid1=stock_grid1";
	var strArg      = "";
	var callBackFnc = "fnCallback";
	var isAsync     = true;

	this.transaction(strSvcId, strSvcUrl, inData, outData, strArg, callBackFnc, isAsync);
};

/* 콜백함수 */
/* 팝업창의 콜백 함수 정의 (테스트용으로 비워둠) */
this.fn_popupCallback = function(strPopupID, strReturn)
{
    if(strReturn == undefined){
        return;
    }

    if(strPopupID == "stock_order_popup"){
        this.alert("Return Value: " + strReturn);
    }
};


/* 4. 체크박스 전체선택/전체해제 */
this.stock01_div_Grid00_onheadclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	if(e.cell == 3){
		/* 체크박스가 존재하는 3번째 column의 text값 가져오기
		== var chkOrder = obj.getCellValue(-1,3); */
		var chkOrder = obj.getCellProperty("head",3,"text");
		
		// 0:미체크 1:체크
		if(chkOrder == "1") {
			// 미체크로 초기화
			chkOrder = "0";
			obj.setCellProperty("head",3,"text",chkOrder);
			for( var i=0; i<this.stock_grid1.rowcount; i++){
				this.stock_grid1.setColumn(i,"PRODUCT_CHECK","0");
			}
		}else {
			chkOrder = "1";
			obj.setCellProperty("head",3,"text",chkOrder);
			for( var i=0; i<this.stock_grid1.rowcount; i++){
				this.stock_grid1.setColumn(i,"PRODUCT_CHECK","1");
			}
		}
	}else if(e.cell ==2){
	alert("정렬기능!");
	}
};

// 체크박스 선택됐을 때 발주수량 edit에 입력 허용되게
this.stock01_div_Grid00_oncellclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
// 	if(e.col == 3){
// 	
// 		// 체크박스의 체크유무 값 가져오기
// 		var chkQuantity = obj.getCellValue(e.row, e.col);
// 		alert("chkQuantity : "+chkQuantity);
// 		
// 		if(chkQuantity == "1")
// 			{
// 				obj.setCellProperty("body", 4, "edittype","text");
// 			}else{
// 				obj.setCellProperty("body", 4,"edittype","readonly");
// 			}
// 		}
};

/*

"expr:Column3=='0'?'':'text'"

*/
]]></Script>
    <Objects>
      <Dataset id="stock_grid1">
        <ColumnInfo>
          <Column id="PRODUCT_NAME" type="STRING" size="256"/>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="PRODUCT_QUANTITY" type="STRING" size="256"/>
          <Column id="PRODUCT_CHECK" type="STRING" size="256" description="발주신청용체크"/>
          <Column id="STOCK_ORDER_QUANTITY" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="stock_grid2">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="STRING" size="256" description="메뉴코드"/>
          <Column id="PRODUCT_NAME" type="STRING" size="256" description="메뉴명"/>
          <Column id="STOCK_ORDER_DATE" type="STRING" size="256" description="발주일자"/>
          <Column id="STOCK_ORDER_QUANTITY" type="STRING" size="256" description="발주수량"/>
          <Column id="ADMIN_CODE" type="STRING" size="256" description="관리자 코드"/>
          <Column id="STOCK_ORDER_STATUS" type="STRING" size="256" description="발주현황"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="stock_order_month">
        <ColumnInfo>
          <Column id="STOCK_ORDER_MONTH" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="STOCK_ORDER_MONTH">01월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">02월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">03월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">04월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">05월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">06월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">07월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">08월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">09월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">10월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">11월</Col>
          </Row>
          <Row>
            <Col id="STOCK_ORDER_MONTH">12월</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="stock_grid3">
        <ColumnInfo>
          <Column id="PRODUCT_NAME" type="STRING" size="256" description="메뉴명"/>
          <Column id="PRODUCT_CODE" type="STRING" size="256" description="메뉴코드"/>
          <Column id="STOCK_IN_QUANTITY" type="STRING" size="256" description="입고"/>
          <Column id="STOCK_OUT_QUANTITY" type="STRING" size="256" description="출고"/>
          <Column id="STOCK_DATE" type="STRING" size="256" description="날짜"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="stock_order">
        <ColumnInfo>
          <Column id="ADMIN_CODE" type="STRING" size="256" description="관리자 코드"/>
          <Column id="STOCK_ORDER_CODE" type="STRING" size="256" description="발주신청서 코드"/>
          <Column id="PRODUCT_CODE" type="STRING" size="256" description="음식코드"/>
          <Column id="PRODUCT_NAME" type="STRING" size="256" description="음식명"/>
          <Column id="PRODUCT_QUANTITY" type="STRING" size="256"/>
          <Column id="STOCK_ORDER_QUANTITY" type="STRING" size="256" description="발주수량"/>
          <Column id="STOCK_ORDER_DATE" type="STRING" size="256" description="발주일자"/>
          <Column id="STOCK_ORDER_STATUS" type="STRING" size="256" description="발주현황"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="food_combo">
        <ColumnInfo>
          <Column id="Column0" type="STRING" size="256"/>
          <Column id="Column1" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
  </Form>
</FDL>
