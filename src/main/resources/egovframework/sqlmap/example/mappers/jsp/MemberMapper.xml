<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="bookcafe.member.serviceImpl.MemberMapper">
 <!-- 회원 등록 -->
    <insert id="insertMember" parameterType="bookcafe.member.service.MemberVO">
        INSERT INTO USER (USER_CODE, USER_ID, USER_PASS, USER_NAME, USER_TEL, USER_EMAIL, USER_ADDRESS, USER_JOINDATE, USER_AUTHORITY) 
        VALUES (fnCode('user'), #{user_id, jdbcType=VARCHAR}, #{user_pass, jdbcType=VARCHAR}, #{user_name, jdbcType=VARCHAR}, #{user_tel, jdbcType=VARCHAR}, #{user_email, jdbcType=VARCHAR}, #{user_address, jdbcType=VARCHAR}, #{user_joindate, jdbcType=VARCHAR}, #{user_authority, jdbcType=VARCHAR} ) 
        </insert>
    
    <!-- 아이디 중복 체크 -->
    <select id="selectIdChk" resultType="int" parameterType="String">
        SELECT COUNT(*)
        FROM USER
        WHERE USER_ID = #{value}
    </select>
    
    <!-- 로그인 처리 -->
    <select id="loginProc" resultType="int" parameterType="bookcafe.member.service.MemberVO">
        SELECT COUNT(*)
        FROM USER
        WHERE USER_ID = #{user_id}
            AND USER_PASS = #{user_pass}
    </select>

	<!-- 아이디 찾기 -->
    <select id="findId" resultType="String" parameterType="bookcafe.member.service.MemberVO">
        SELECT USER_ID
        FROM USER
        WHERE USER_NAME = #{user_name}
        AND USER_TEL = #{user_tel}
    </select>

    <!-- 비밀번호 찾기 -->
    <select id="findPw" resultType="int" parameterType="bookcafe.member.service.MemberVO">
        SELECT COUNT(*)
        FROM USER
        WHERE USER_ID = #{user_id}
        AND USER_NAME = #{user_name}
        AND USER_TEL = #{user_tel}
    </select>
	
	<!-- 비밀번호 재설정 -->
    <update id="resetPassword" parameterType="bookcafe.member.service.MemberVO">
        UPDATE USER
        SET USER_PASS = #{new_password}
        WHERE USER_ID = #{user_id}
    </update>
    
    <!--  사용자 정보 조회 쿼리 추가  -->
	<select id="getUserInfo" parameterType="String" resultType="bookcafe.member.service.MemberVO"> 
		SELECT * 
		FROM USER 
		WHERE USER_ID = #{user_id} 
	</select>
	
	<!-- 비회원가입 -->
	<insert id="insertbMember" parameterType="bookcafe.member.service.MemberVO"> 
		INSERT INTO USER(USER_CODE, USER_NAME, USER_TEL, USER_EMAIL, USER_ADDRESS, USER_JOINDATE, USER_AUTHORITY) 
		VALUES ( fnCode('user'), #{user_name, jdbcType=VARCHAR}, #{user_tel, jdbcType=VARCHAR}, #{user_email, jdbcType=VARCHAR}, #{user_address, jdbcType=VARCHAR}, #{user_joindate, jdbcType=VARCHAR}, #{user_authority, jdbcType=VARCHAR} ) 
		</insert>
	
	<!--  전화번호 중복 체크  -->
	<select id="selectTelChk" resultType="int" parameterType="String"> 
		SELECT COUNT(*) 
		FROM USER 
		WHERE USER_TEL = #{value} 
	</select>
	
	<!--  비회원 정보 업데이트  -->
	<update id="updateNonMember" parameterType="bookcafe.member.service.MemberVO">
		UPDATE USER 
		SET USER_NAME = #{user_name},
		USER_EMAIL = #{user_email},
		USER_ADDRESS = #{user_address} 
		WHERE USER_TEL = #{user_tel}
	</update>
	
</mapper>